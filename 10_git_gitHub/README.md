# はじめてのGit/GitHub
ここでは、第一にGitHub上に共有されているリポジトリ（プロジェクト）をダウンロードしてからvscodeで開き、自分用にカスタムする方法を示す。GitHub上には様々なプロジェクトが共有されているため、いわばGitHubの歩き方を知ることで、他者によるスクリプトから多くを学ぶことができるようになる。

第二にGitでプロジェクトを管理しながらGitHub上で共有する方法を示す。Git/GitHubは複数人で協働してプロジェクトを進めるための様々な機能が用意されているが、ここではその取っ掛かりとして、研究室内でプロジェクトを共有しながら開発を進めるためのごく基本的な手順について学び：
- 開発の仮定で _test.py_、 _test_1.py_、 _test_backup.py_ 的なファイルが沢山作成され
- 使っているファイルの微妙な違いから先輩のPCだと動作するが自分のPCだと動作しない状態になり
- よくわからないため先輩のプロジェクト（スクリプト類）を一式改めてコピーしてもらい
- 自分が作業していた経過を破棄せざるを得なくなる
- 結果的にどれが最新のプロジェクトが分からなくなり
- プロジェクトと正しく動作させる方法が後輩に引き継がれない

という悪循環に陥らないマインドを形成するのが目的。

## GitHubからリポジトリをダウンロードする
GitHubにあるプロジェクトをちょっと手元で使ってみるなら。これまでに学んだようにPythonのスクリプトでは、他の.pyに書いてある機能をimportして使うことができるため、.pyだけあれば必ず動作するとものではない。リポジトリにあるファイル一式をダウンロードするには、次図のようにリポジトリのトップにおいて、右にある **<> Code** から **Download ZIP**をクリックする。
![image](./assets/2023-05-26%20141526.png)

ダウンロードしたら展開後、フォルダを適用なディレクトリに移動してからvscodeで開く。この際にプロジェクト内の.py単体を開くのではなく、 **Open Folder...** からフォルダを開くこと。また、Windowsだと.zipをダブルクリックした際の動作設定によっては、展開せずに中のファイルを見ることができる場合もあるので注意。ちゃんと展開してから操作すること。

加えて、ダウンロードしたプロジェクトを実行して動作を確かめる場合、悪意のあるスクリプトが実行されればPCにダメージがあることもある。GitHubに共有されていることは、危険性がないことを意味しないので注意。ちゃんと中を読むか、最低でもある程度評価（次図）がついていることを確認すること。
![image](./assets/2023-05-26%20143302.png)

## GitHubを使う上で知っておくとよいこと
### README
GitHubを見るとそのリポジトリに関する説明やリポジトリに共有されているスクリプトを実行するための方法などが書かれていることが多い。基本的なことはこのREADME（ファイルの実体としてはREADME.md）に書かれているので目を通すこと。

なお、この解説もREADME.mdに書いている。README.mdはmarkdownと呼ばれる文章記述のためのコンパクトなマークアップ言語を使って書く。自分の研究を行うにあたり **リポジトリを作成した際にはREADME.mdをしっかり整備する**ようお願いします。

### Issues
GitHubには、協働での開発におけるコミュニケーションのためにリポジトリ毎に **Issues**とよばれる掲示板のような機能が用意されている。先のREADME.mdがリポジトリの作成者が作成するものであるのに対し IssuesはGitHubの閲覧者が投稿できることから、Q&Aとして利用されていることも多く：

- このリポジトリのものはPhthon ver.xxでないと動かなかったという補足
- READMEの通りに実行したらxxのようなエラーがでたという報告（Q）
- ↑に対し、yy.pyのn行目をzzすれば良いという助言（A）
があったりと、躓いた際の解決方法が書かれていることも多い。

なお、Issuesには、アクティビティ（議論の途中）な **Open Issue**と、一応解決済みという扱いになっている **Closed Issue**がある。後者に問題解決のヒントが有る場合もあるが、知らないと存在に気づかないので念のためその存在をお知らせしておく。ちょっとわかりにくいが、Closed Issueは次図でいう「126 Closed」となっているグレーアウトしているリンクから開くことできる。
![image](./assets/2023-05-26%20143634.png)

### サードパーティのパッケージ
Pythonでは、標準に組み込まれているパッケージ（関数などの機能がまとまったもの）や、自分で作成した.pyをインポートして使うほか、サードパーティのパッケージを使ってスクリプトを書くこともできる。例えば、jpgを開いたり編集したりと画像処理を行うOpenCV、数値計算を行うNumPy、深層学習を行うPytorchやTensorflowなどはサードパーティのパッケージ。

サードパーティのパッケージは、（他の方法もあるが）pipというツールを使って管理する。イメージとしては：
- Pythonをインストールしたままの状態では標準の組み込みパッケージしか扱えないが
- 画像処理を行うプロジェクトを開発する際には`pip install opencv-python`を行い、OpenCVのパッケージをPython（環境）に加える
- 追加したパッケージを用いる場合は.pyにおいてimportを行う

ということを行う。
例えば **sample10.py**は画像を開いて表示するスクリプトであるが、`import cv2`してOpenCVをインポートしている。`cv2.`から始まる部分にて、OpenCVのパッケージに用意されている機能（ここでは関数）を使っている。

実行時に、パッケージが不足している場合には、以下のようなメッセージが表示される。
>Traceback (most recent call last):
  File "D:\prepare_python_dev_env\10_git_gitHub\sample10.py", line 1, in <module>
    import cv2
ModuleNotFoundError: No module named 'cv2'

不足しているのが、本来はプロジェクトに含まれているべきファイルであるのが、サードパーティであるかは区別がつきにくいが、先の例でいれば：
>ModuleNotFoundError: No module named 'cv2'

で検索して、それなら「pip install～などを行いなさい」的な結果が得られたらサードパーティの不足だと判断できる。そうでない場合はプロジェクトないで適切な場所にファイルがない、などの可能性を疑う。

#### 必要なパッケージの用意・requirements.txt
親切なリポジトリであればREADMEに以下のような記述があるのでそれに従えばOKであることが多い。
```
pip install xxx
pip install yyy
```
また、より親切なリポジトリでは、 **requirements.txt**なるファイルが用意されていることもある。これは、プロジェクトの実行に必要なパッケージを列挙してもので：
```
pip install -r requirements.txt
```
を実行することで一括でパッケージのインストールができる。また：
```
pip freeze > requirements.txt
```
を実行することで、**requirements.txt**を作ることもできる。自分が作成したリポジトリでは作成するように心がけると良い。

## 仮想環境
`pip install　xxx`は、そのプロジェクトに対してパッケージxxxをインストールするのでなく、そのPCにインストールされているPython（厳密には標準で実行されるPython環境）に対してパッケージxxxをインストールするものである。よって、複数のプロジェクトを扱うようになるとパッケージのバージョンで問題が起きる場合がある。例えば、プロジェクト「MNIST_cla」（手書き文字認識）では、パッケージxxx ver.2.2が要るが、プロジェクト「Pointnet_partseg」（点群のセグメンテーション）では、同じくパッケージxxxが要るが、ver.2.0でないと動作しないなど。

この問題を解決するために、Pythonでは仮想環境という仕組みが用意されている。要するにそのプロジェクト専用の仮想的なPython環境を作ってしまおうというものである。

仮想環境は：
```
python -m venv ".venv"
```
を実行することで作成することができる。ここでは、 **.venv**という名前の仮想環境を作成しており実行を終えると同名のフォルダができることが確認できる。仮想環境を有効にするには：
```
.\.venv\Scripts\activate
```
を実行する。

なお、windowsでは仮想環境をアクティベートしようとした際に以下のように読み込むことができない旨が表示される。

>このシステムではスクリプトの実行が無効になっているため、～を読み込むことができません。

これは、PCの保護のためスクリプトの実行を無効としている設定によるもので、以下のコマンドをVSCodeのターミナル（かPowershell）から実行してセキュリティポリシーを変更しておくことで解決できる。
```
Set-ExecutionPolicy RemoteSigned -Scope Process -force
```

ポリシーの変更後アクティベートを改めて行い、次図のようにターミナルの先頭が **(.venv)**のように仮想環境名になっていれば仮想環境が適用されている状態。
![image](./assets/2023-05-26%20161451.png)

なお、仮想環境はそのプロジェクトの場所を変えると動作しなくなるの注意。




## Git/GitHubで管理する
### GitHubのアカウントを作成
[GitHub](https://github.co.jp/)にアクセスしてアカウントを作成する。研究室的には、研究に使ったプロジェクトのリポジトリは残しておくし、条件があえば公開する（GitHubのリポジトリにはpublicのものと、メンバーオンリーなprivateなものがある）ことを想定している。誰の貢献であるか後からポートフォリオ的にわかるようにしておきたいので、長く使えるメールアドレスで作成したほうがよい（≒大学のメールアドレスでないほうがよい）。

### Gitのインストール
[Git](https://gitforwindows.org/)をダウンロード、インストールする。基本的にデフォルトで良いと思われるが、次図のように **Choosing the default editor used by Git**を **vscode**にすると良さそう。
![image](./assets/2023-05-26%20164621.png)

Powershellを開いて`git --version`して次図のようにバージョンが表示されればOK。
![image](./assets/2023-05-26%20165020.png)

最後に、Powershellにて以下のコマンドを実行し、Gitにユーザー情報を登録しておく。これはあくまでGit（≠GitHub）にて履歴を残す際の「誰が」という情報を扱うためのものであるが、ひとまずGitHubにアカウント名とメールアドレスにしておけば良いと思われる。
```
git config --global user.name "ユーザー名"
git config --global user.email "メールアドレス"
```

### VSCodeでGitする
Git/GitHubで管理を行いながらプロジェクトの開発を行う場合は、リポジトリをダウンロードする際に、zipをダウンロードするのではなく、リポジトリをクローンする方法を採る。研究（室）的な範囲では：
- 研究室のリポジトリを使う→クローン
- 他者のリポジトリを使ってみる→zipでダウンロード

という使い分けで良いと思われる。なお、GitHubには、他者によるリポジトリをクローン（フォーク）して開発に寄与するという方法もあるが、ここでは置いておく。


以下のようにクローン用のURLをコピーしておき、続いてvscodeで **新しいウインドウ**より **Clone Git Repository**してURLをペーストしてからクローンする。

![image](./assets/2023-05-26%20170126.png)
![image](./assets/2023-05-26%20171131.png)

なお、研究室のリポジトリへのアクセスするにはGitHubアカウントへのログインが必要なため、初回のみ以下のようにURL記入欄の下の **Clone from GitHub**をクリックしてVSCodeにGitHubアカウントへアクセスする許可を与える必要がある。

![image](./assets/2023-06-08%20092915.png)

### 適当なリポジトリでGit体験
以下を確認
- 適当なリポジトリをクローン
- vscode上で変更がトラッキングされること

#### Gitで基本的に行うべきこと
add、commit、push（pull）などの意味。

#### トラッキングの制御
- .gitignore  
深層学習の学習用データなどをGitHubにアップロードしてしまうとリポジトリのファイル容量の上限に引っかかってしまう。他、テスト用の出力など、Git（GitHub）にで管理しなくても良いものは **.gitignore**に書いておくと良い。
例えば、このリポジトリの直下にある **.gitignore**は以下のように指定が含まれている。
```
.venv
**.pyc
```
これは、仮想環境関係のファイルが含まれるフォルダ **.venv**は全て無視（ignore）するという指定と、拡張子が **.pyc**である全てのファイルを無視するという指定（.pycは、pythonのスクリプトをimportした際に作成される、.pyをコンピューター的に読みやすく変換したもので、処理を高速化するもの）。

`*`は「全ての」のようなワイルドカードを意味し、`*.pyc`であれば **.gitignore**と同じフォルダにある全ての.pycファイル、`**.pyc`では、全てのフォルダにある全ての.pycファイルを意味する。

- Discard Chargeに注意  
変更を破棄するということである。**.gitignore**の指定を失念して、意図せず大量のファイルがトラッキングされてしまった際に **Discard Charge**すると、新規に作成されたという変更が破棄される、つまり **ファイルが削除**されるので注意。

- 個人情報を含めないこと  
例えばスクリプト内にメールアドレス（やOpenAIのAPI_Key）などを書いてCommit、PushするとGitの履歴情報にこれらが残る。消せないこともないけど注意。

#### ちょっとしたパラメータの変更がトラッキングされてしまう
**sample10.py**は以下のようなスクリプト。
```
import cv2

if __name__ == '__main__':
    img_path = './10_git_github/assets/2023-05-26 143634.png'
    img = cv2.imread(img_path)
    cv2.imshow('test', img)
    cv2.waitKey(0)
```
`import cv2`で画像処理を行うopencv-pythonをインポートし、`cv2.imread`で読み込んだあと`cv2.imshow`で表示を行っている。
このスクリプトをひとまず画像を開いて何かしらの処理を行うスクリプトだと解釈すると、gitでの管理において、読み込むファイルを変更するたびに **変更が加わった**と記録されてしまうことがわかる。同様に、何かしらの処理を行う際のパラメータ（例えばサイズを1/2にする、1/3にする、など）の変更も記録され、 **本来のスクリプトの実装のための変更記録**に **使用する際のパラメータの変更**が混在してしまう。

この問題は **argparse**を使うと解決できる。 **sample10-argparse.py**は先程のsample10.pyにargparseを適用したもの。
```
import cv2
import argparse

parser = argparse.ArgumentParser(description='display an image')
parser.add_argument("-i", "--input_path", help="input image path", required=True, type=str)

if __name__ == '__main__':
    args = parser.parse_args()
    img_path = args.input_path
    # img_path = './10_git_github/assets/2023-05-26 143634.png'
    img = cv2.imread(img_path)
    cv2.imshow('test', img)
    cv2.waitKey(0)
```
このスクリプトを実行する際には、Run>Run Without Debuggingでなく、ターミナルから
```
python.exe .\10_git_gitHub\sample10-argparse.py -i '.\10_git_gitHub\assets\2023-05-26 141526.png'
```
のように、 **-i**に続けて開きたいファイルを指定する。
